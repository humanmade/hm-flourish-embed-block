(()=>{"use strict";var e={n:t=>{var l=t&&t.__esModule?()=>t.default:()=>t;return e.d(l,{a:l}),l},d:(t,l)=>{for(var a in l)e.o(l,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:l[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,l=window.wp.blocks,a=window.wp.blockEditor,n=window.wp.data,r=window.wp.components,o=window.wp.apiFetch;var i=e.n(o);const s=window.wp.element,d=window.wp.url;function c({block:e,attributes:l={},messages:a={}}){const n={emptyResponse:"No content to display",error:"Error",...a},[o,c]=(0,s.useState)(""),[m,u]=(0,s.useState)(!0),[p,b]=(0,s.useState)(null);return(0,s.useEffect)(()=>{u(!0),b(null);const t=(0,d.addQueryArgs)(`/wp/v2/block-renderer/${e}`,{context:"edit",sandboxedPreview:"1"});i()({path:t,method:"POST",data:{attributes:l}}).then(e=>{c(e.rendered||""),u(!1)}).catch(e=>{b(e.message||"Unknown error"),u(!1)})},[e,JSON.stringify(l)]),m?(0,t.createElement)("div",{style:{textAlign:"center",padding:"2em"}},(0,t.createElement)(r.Spinner,null)):p?(0,t.createElement)("div",{style:{padding:"1em",border:"1px solid #dc3232",backgroundColor:"#fef7f7"}},(0,t.createElement)("strong",null,n.error,":")," ",p):o?(0,t.createElement)(r.SandBox,{html:o}):(0,t.createElement)("div",{style:{padding:"1em",border:"1px solid #ddd",backgroundColor:"#f9f9f9"}},n.emptyResponse)}(0,l.registerBlockType)("hm/flourish-embed",{title:"Flourish Embed",description:"Embed Flourish data visualizations",category:"embed",icon:"chart-line",edit:({attributes:e,setAttributes:l})=>{const o=(0,a.useBlockProps)(),{type:i,id:s,fallbackImageId:d,useFallbackImageForRSS:m}=e,u=(0,n.useSelect)(e=>d?e("core").getMedia(d):null,[d]),p=u?.source_url;return(0,t.createElement)(t.Fragment,null,(0,t.createElement)(a.InspectorControls,null,(0,t.createElement)(r.PanelBody,{title:"Flourish Settings"},(0,t.createElement)(r.SelectControl,{label:"Type",value:i,options:[{label:"Visualisation",value:"visualisation"},{label:"Story",value:"story"}],onChange:e=>l({type:e})}),(0,t.createElement)(r.TextControl,{label:"ID",value:s,onChange:e=>l({id:e}),placeholder:"Enter Flourish ID"})),(0,t.createElement)(r.PanelBody,{title:"Fallback Image"},(0,t.createElement)(a.MediaUploadCheck,null,(0,t.createElement)(a.MediaUpload,{onSelect:e=>l({fallbackImageId:e.id}),allowedTypes:["image"],value:d,render:({open:e})=>(0,t.createElement)(t.Fragment,null,p&&(0,t.createElement)("div",{style:{marginBottom:"10px"}},(0,t.createElement)("img",{src:p,alt:"Fallback",style:{maxWidth:"100%",height:"auto"}})),(0,t.createElement)(r.Button,{onClick:e,variant:"primary"},d?"Replace Image":"Upload Image"),d?(0,t.createElement)(r.Button,{onClick:()=>l({fallbackImageId:0}),variant:"secondary",style:{marginLeft:"10px"}},"Remove Image"):null)})),d>0&&(0,t.createElement)("div",{style:{marginTop:"15px"}},(0,t.createElement)(r.ToggleControl,{label:"Use in RSS Feeds",help:m?"Fallback image will be shown in RSS feeds":"Standard Flourish embed will be shown in RSS feeds",checked:m,onChange:e=>l({useFallbackImageForRSS:e})})))),(0,t.createElement)("div",{...o},(0,t.createElement)(c,{block:"hm/flourish-embed",attributes:e,messages:{emptyResponse:"Please enter a Flourish ID to preview the embed."}})))},save:()=>null})})();